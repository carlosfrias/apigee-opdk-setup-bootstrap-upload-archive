---
# tasks file for apigee-opdk-setup-local-repository-archive
- name: Clean up and repos in /tmp
  file:
    path: '{{ apigeerepobasepath }}/repos'
    state: absent
#- block:
#  - name: Unarchive local archive to remote nodes
#    unarchive:
#      src: '{{ local_apigee_path }}/{{ archive_name }}'
#      dest: '{{ apigeerepobasepath }}'
#      copy: '{{ copy_archive }}'
#
#  rescue:
- name: Install rsync if its missing
  yum:
    name: rsync
    state: present

- name: Use rsync to copy to remote node
  synchronize:
    src: "{{ local_apigee_path }}/{{ archive_name }}"
    dest: "{{ apigeerepobasepath }}/{{ archive_name }}"

- name: Unarchive local archive to remote nodes
  unarchive:
    src: '{{ apigeerepobasepath }}/{{ archive_name }}'
    dest: '{{ apigeerepobasepath }}'
    copy: false


